{"version":3,"file":"bundle.js","sources":["../node_modules/_@babel_runtime@7.14.5@@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/_@babel_runtime@7.14.5@@babel/runtime/helpers/esm/defineProperty.js","../src/手写系列/Promise/链式调用then.js"],"sourcesContent":["export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","const STATUS = {\n  PENDING: 'pending',\n  FULFILLED: 'fulfilled',\n  REJECTED: 'rejected'\n}\n\nclass MyPromise {\n  constructor (executor) {\n      // 执行器\n      try {\n          executor(this.resolve, this.reject)\n      } catch (error) {\n          this.reject(error)\n      }\n  }\n\n  // 成功回调\n  onFulfilledCallback = []\n\n  // 失败回调\n  onRejectedCallback = []\n\n  // 初始状态\n  status = STATUS.PENDING\n  \n  // 成功返回值\n  value = null\n  \n  // 失败返回值\n  resolve = null\n  \n  // 修改 Promise 状态，并定义成功返回值\n  resolve = value => {\n    if (this.status === STATUS.PENDING) {\n        this.status = STATUS.FULFILLED\n        this.value = value\n\n        while(this.onFulfilledCallback.length) {\n            this.onFulfilledCallback.shift()(value)\n        }\n    }\n  }\n  \n  // 修改 Promise 状态，并定义失败返回值\n    reject = value => {\n        if (this.status === STATUS.PENDING) {\n            this.status = STATUS.REJECTED\n            this.reason = value\n\n            while(this.onRejectedCallback.length) {\n                this.onRejectedCallback.shift()(value)\n            }\n        }\n    }\n\n    then = function (onFulfilled, onRejected) {\n        onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : value => value\n        onRejected = typeof onRejected === 'function' ? onRejected : error => { throw error }\n      \n        const promise2 = new MyPromise((resolve, reject) => {\n          if (this.status === STATUS.PENDING) {\n              this.onFulfilledCallback.push(() => {\n                  try {\n                      const x = onFulfilled(this.value)\n                      resolvePromise(promise2, x, resolve, reject)\n                  } catch (error) {\n                      reject(error)\n                  }\n              })\n              this.onRejectedCallback.push(() => {\n                  try {\n                      const x = onRejected(this.value)\n                      resolvePromise(promise2, x, resolve, reject)\n                  } catch (error) {\n                      reject(error)\n                  }\n              })\n          } else if (this.status === STATUS.FULFILLED) {\n              try {\n                  const x = onFulfilled(this.value)\n                  resolvePromise(promise2, x, resolve, reject)\n              } catch (error) {\n                  reject(error)\n              }\n          } else if (this.status === STATUS.REJECTED) {\n              try {\n                  const x = onRejected(this.reason)\n                  resolvePromise(promise2, x, resolve, reject)\n              } catch (error) {\n                  reject(error)\n              }\n          }\n        }) \n\n        return promise2\n    }\n}\n\nfunction resolvePromise (promise2, x, resolve, reject) {\n    if (promise2 === x) {\n      reject(new TypeError('The promise and the return value are the same'))\n    }\n\n    if ( x instanceof MyPromise) {\n      let then\n      try {\n        then = x.then\n      } catch (error) {\n        reject(error)\n      }\n\n      if (then instanceof Function) {\n        then.call(x, y => {\n          // resolve的结果依旧是promise 那就继续解析\n          resolvePromise(promise2, y, resolve, reject);\n        }, err => {\n          reject(err);// 失败了\n        })\n      }\n      resolve(x)\n    }\n    resolve(x)\n}\n\nconst mypromise = new MyPromise((resolve, reject) => {\n  resolve('成功')\n})\n\nconst mypromise2 = new MyPromise((resolve, reject) => {\n  resolve('成功2')\n})\n\nmypromise.then(data => {\n  console.log(data, '1')\n  return mypromise2 \n}).then(data => {\n  console.log(data, '2')\n})"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","STATUS","PENDING","FULFILLED","REJECTED","MyPromise","executor","status","onFulfilledCallback","length","shift","reason","onRejectedCallback","onFulfilled","onRejected","error","promise2","resolve","reject","push","x","resolvePromise","then","Function","call","y","err","mypromise","mypromise2","data","console","log"],"mappings":"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"}