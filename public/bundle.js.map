{"version":3,"file":"bundle.js","sources":["../node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/@babel/runtime/helpers/esm/createClass.js","../node_modules/@babel/runtime/helpers/esm/defineProperty.js","../src/手写系列/Promise/异步事件.js"],"sourcesContent":["export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","const STATUS = {\n  PENDING: 'pending',\n  FULFILLED: 'fulfilled',\n  REJECTED: 'rejected'\n}\n\nclass MyPromise {\n  constructor (executor) {\n      // 执行器\n      try {\n          executor(this.resolve, this.reject)\n      } catch (error) {\n          this.reject(error)\n      }\n  }\n\n  // 成功回调\n  onFulfilledCallbacks = []\n\n  // 失败回调\n  onRejectedCallbacks = []\n\n  // 初始状态\n  status = STATUS.PENDING\n  \n  // 成功返回值\n  value = null\n  \n  // 失败返回值\n  resolve = null\n  \n  // 修改 Promise 状态，并定义成功返回值\n  resolve = value => {\n    if (this.status === STATUS.PENDING) {\n        this.status = STATUS.FULFILLED\n        this.value = value\n\n        while(this.onFulfilledCallbacks.length) {\n            this.onFulfilledCallbacks.shift()(value)\n        }\n    }\n  }\n  \n  // 修改 Promise 状态，并定义失败返回值\n    reject = value => {\n        if (this.status === STATUS.PENDING) {\n            this.status = STATUS.REJECTED\n            this.reason = value\n\n            while(this.onRejectedCallbacks.length) {\n                this.onRejectedCallbacks.shift()(value)\n            }\n        }\n    }\n\n    then (onFulfilled, onRejected) {\n        const realOnFulfilled = typeof onFulfilled === 'function' ? onFulfilled : value => value\n        const realOnRejected = typeof onRejected === 'function' ? onRejected : error => { throw error }\n      \n        const promise2 = new MyPromise((resolve, reject) => {\n          \n          const fulfilledMicrotask = () =>  {\n            // 创建一个微任务等待 promise2 完成初始化\n            queueMicrotask(() => {\n              try {\n                // 获取成功回调函数的执行结果\n                const x = realOnFulfilled(this.value);\n                // 传入 resolvePromise 集中处理\n                resolvePromise(promise2, x, resolve, reject);\n              } catch (error) {\n                reject(error)\n              } \n            })  \n          }\n  \n        const rejectedMicrotask = () => { \n            // 创建一个微任务等待 promise2 完成初始化\n            queueMicrotask(() => {\n              try {\n                // 调用失败回调，并且把原因返回\n                const x = realOnRejected(this.reason);\n                // 传入 resolvePromise 集中处理\n                resolvePromise(promise2, x, resolve, reject);\n              } catch (error) {\n                reject(error)\n              } \n            }) \n          }\n\n          if (this.status === STATUS.PENDING) {\n              this.onFulfilledCallbacks.push(fulfilledMicrotask)\n              this.onRejectedCallbacks.push(rejectedMicrotask)\n          } else if (this.status === STATUS.FULFILLED) {\n            fulfilledMicrotask()\n          } else if (this.status === STATUS.REJECTED) {\n            rejectedMicrotask()\n          }\n        }) \n\n        return promise2\n    }\n}\n\nfunction resolvePromise (promise, x, resolve, reject) {\n  // 如果 promise === x， 执行 reject，错误原因为 TypeError\n    if (promise === x) {\n      return reject(new TypeError('The promise and the return value are the same'))\n    }\n\n    // 如果 x 是对象或函数\n    if (typeof x === 'object' || typeof x === 'function') {\n\n      if (x === null) {\n        return resolve(x);\n      }\n\n      let then\n      try {\n        then = x.then\n      } catch (error) {\n        return reject(error)\n      }\n\n      // 如果 x.then 是函数\n      if (typeof then === 'function') {\n        let called = false;\n        try {\n          then.call(x, y => {\n            // resolve的结果依旧是promise 那就继续解析\n            if (called) return;\n                called = true;\n            resolvePromise(promise, y, resolve, reject);\n          }, err => {\n            if (called) return;\n                called = true;\n            reject(err);// 失败了\n          })\n        } catch (error) {\n          if (called) return;\n          reject(error)\n        }\n      } else {\n        // 如果 x.then 不是函数\n        resolve(x)\n      }\n    } else {\n      // 如果 x 不是 promise 实例\n      resolve(x)\n    }\n\n}\n\nconst mypromise = new MyPromise((resolve, reject) => {\n  setTimeout(() => resolve('成功'), 1000)\n})\n\nconst mypromise2 = new MyPromise((resolve, reject) => {\n  setTimeout(() => resolve('成功2'), 1000)\n})\n\nmypromise.then(data => {\n  console.log(data, '1')\n  return mypromise2 \n}).then(data => {\n  console.log(data, '2')\n})"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","_defineProperty","value","STATUS","PENDING","FULFILLED","REJECTED","MyPromise","executor","status","onFulfilledCallbacks","shift","reason","onRejectedCallbacks","resolve","reject","error","onFulfilled","onRejected","realOnFulfilled","realOnRejected","promise2","fulfilledMicrotask","queueMicrotask","x","resolvePromise","rejectedMicrotask","push","promise","then","called","call","y","err","mypromise","setTimeout","mypromise2","data","console","log"],"mappings":"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"}